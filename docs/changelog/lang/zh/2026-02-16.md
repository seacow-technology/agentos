# 2026-02-16：WebUI 产品面刷新、Context Optimizer v2、LLM 用量与价格可观测性

本次发布重点是把 WebUI/桌面端产品面做了一轮整合升级，引入 context optimizer（含 v2 预算与签名链路），并补齐 LLM 用量事件与模型价格落库能力，便于后续成本与行为观测。

## Commit 证据（Master）

```text
f518b952  feat(webui): batch integrate pending changes before v3.5.0 release
```

## 1）WebUI/产品面更新

交付：
- 新增 product API 面并接入 WebUI 路由注册。
- 新增/更新多处 WebUI 页面与交互：AWS 运维入口、模型价格弹窗、模型/Provider/Chat 等关键路径。
- 扩展中英文 i18n 文案与 keys。

关键文件：
- `apps/webui/src/pages/AwsOpsPage.tsx`
- `apps/webui/src/components/providers/ModelPricingDialog.tsx`
- `apps/webui/src/pages/ModelsPage.tsx`
- `apps/webui/src/pages/ProvidersPage.tsx`
- `apps/webui/src/pages/ChatPage.tsx`
- `apps/webui/src/ui/text/dict.en.ts`
- `apps/webui/src/ui/text/dict.zh.ts`
- `apps/webui/src/ui/text/keys.ts`
- `os/octopusos/webui/api/product.py`
- `os/octopusos/webui/contract/router_registry.py`

## 2）Context Optimizer v1/v2 管线（CLI/Tool/UI）

交付：
- 新增 `context_optimizer` 模块，覆盖 CLI/Tool/UI 场景的规则化裁剪链路。
- 引入 v2 能力：预算分配、context pack 构建、指针解析、语义校验、签名与签名存储、评测辅助。
- 新增 WebUI API 入口用于 optimizer 调用。

关键文件：
- `os/octopusos/core/context_optimizer/pipeline.py`
- `os/octopusos/core/context_optimizer/rules/cli_optimizer.py`
- `os/octopusos/core/context_optimizer/rules/tool_optimizer.py`
- `os/octopusos/core/context_optimizer/rules/ui_optimizer.py`
- `os/octopusos/core/context_optimizer/v2/budget_allocator.py`
- `os/octopusos/core/context_optimizer/v2/context_pack_builder.py`
- `os/octopusos/core/context_optimizer/v2/semantic_validator.py`
- `os/octopusos/core/context_optimizer/v2/signature_store.py`
- `os/octopusos/webui/api/context_optimizer.py`
- `tests/unit/context_optimizer/*`

## 3）LLM 用量事件 + 模型价格持久化

交付：
- 在 LLM 核心层新增 usage events 与 pricing 相关能力。
- 新增数据库迁移，落 usage events 与 model pricing 结构。
- 增加对应 smoke/unit 测试，支持后续用量统计与成本核算。

关键文件：
- `os/octopusos/core/llm/usage_events.py`
- `os/octopusos/core/llm/pricing.py`
- `os/octopusos/store/migrations/schema_v101_llm_usage_events.sql`
- `os/octopusos/store/migrations/schema_v102_llm_model_pricing.sql`
- `tests/unit/llm/test_llm_usage_events.py`

## 4）桌面端打包资源调整

交付：
- 新增桌面端打包 `product-dist` 资源。
- 调整 Electron 主进程/预加载/proxy/sidecars 相关集成路径。

关键文件：
- `apps/desktop-electron/resources/product-dist/index.html`
- `apps/desktop-electron/resources/product-dist/app.js`
- `apps/desktop-electron/resources/product-dist/app.css`
- `apps/desktop-electron/src/main.ts`
- `apps/desktop-electron/src/preload.ts`
- `apps/desktop-electron/src/proxyServer.ts`
- `apps/desktop-electron/src/sidecars.ts`

