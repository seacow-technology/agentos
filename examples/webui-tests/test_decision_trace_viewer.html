<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decision Trace Viewer Test</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/components.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f9fafb;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 20px;
        }
        h1 {
            margin-top: 0;
            color: #111827;
        }
        .test-section {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #374151;
        }
        .mock-data-info {
            background: #dbeafe;
            border: 1px solid #93c5fd;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 20px;
            color: #1e40af;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Decision Trace Viewer - Test Page</h1>

        <div class="mock-data-info">
            <strong>Note:</strong> This is a test page demonstrating the Decision Trace Viewer UI with mock data.
            The actual implementation requires a running AgentOS backend with task data.
        </div>

        <div class="test-section">
            <h3>Trace Filters</h3>
            <div class="trace-filters">
                <input type="text" class="trace-search" placeholder="Search in trace..." id="trace-search">
                <select class="trace-filter" id="trace-filter-type">
                    <option value="">All Decisions</option>
                    <option value="ALLOWED">ALLOWED</option>
                    <option value="BLOCKED">BLOCKED</option>
                    <option value="PAUSED">PAUSED</option>
                    <option value="RETRY">RETRY</option>
                </select>
            </div>
        </div>

        <div class="test-section">
            <h3>Decision Trace Timeline</h3>
            <div class="decision-trace-timeline">
                <!-- Mock Trace Item 1: ALLOWED Decision -->
                <div class="trace-item" data-decision-type="ALLOWED">
                    <div class="trace-timestamp">2024-01-28 10:30:00</div>
                    <div class="trace-line"></div>
                    <div class="trace-content">
                        <div class="trace-event">
                            <span class="event-type-badge event-audit">SUPERVISOR AUDIT</span>
                            <span class="event-source">SUPERVISOR_ALLOWED</span>
                        </div>
                        <div class="trace-decision">
                            <span class="decision-badge decision-allowed">
                                <span class="material-icons md-18">check_circle</span> ALLOWED
                            </span>
                            <div class="decision-reason">Task approved: Risk score below threshold</div>
                        </div>
                        <div class="trace-rules">
                            <div class="rules-label">Rules Applied:</div>
                            <div class="rules-list">
                                <span class="rule-badge">risk_threshold_check</span>
                                <span class="rule-badge">capability_validation</span>
                            </div>
                        </div>
                        <div class="trace-risk">
                            <span class="risk-label">Risk Score:</span>
                            <span class="risk-value risk-low">35/100</span>
                        </div>
                        <div class="trace-json-toggle">
                            <button class="btn-link trace-toggle-json" onclick="toggleJson('json1')">Show JSON</button>
                        </div>
                        <div class="trace-json hidden" id="json1">
                            <pre>{
  "decision_type": "ALLOWED",
  "rules_applied": ["risk_threshold_check", "capability_validation"],
  "metadata": {
    "risk_score": 35,
    "reason": "Task approved: Risk score below threshold"
  }
}</pre>
                        </div>
                    </div>
                </div>

                <!-- Mock Trace Item 2: BLOCKED Decision -->
                <div class="trace-item" data-decision-type="BLOCKED">
                    <div class="trace-timestamp">2024-01-28 10:25:00</div>
                    <div class="trace-line"></div>
                    <div class="trace-content">
                        <div class="trace-event">
                            <span class="event-type-badge event-audit">SUPERVISOR AUDIT</span>
                            <span class="event-source">SUPERVISOR_BLOCKED</span>
                        </div>
                        <div class="trace-decision">
                            <span class="decision-badge decision-blocked">
                                <span class="material-icons md-18">block</span> BLOCKED
                            </span>
                            <div class="decision-reason">Blocked: HIGH_RISK_OPERATION</div>
                        </div>
                        <div class="trace-rules">
                            <div class="rules-label">Rules Applied:</div>
                            <div class="rules-list">
                                <span class="rule-badge">risk_threshold_check</span>
                                <span class="rule-badge">destructive_action_policy</span>
                            </div>
                        </div>
                        <div class="trace-risk">
                            <span class="risk-label">Risk Score:</span>
                            <span class="risk-value risk-high">95/100</span>
                        </div>
                        <div class="trace-json-toggle">
                            <button class="btn-link trace-toggle-json" onclick="toggleJson('json2')">Show JSON</button>
                        </div>
                        <div class="trace-json hidden" id="json2">
                            <pre>{
  "decision_type": "BLOCKED",
  "blocked_reason_code": "HIGH_RISK_OPERATION",
  "rules_applied": ["risk_threshold_check", "destructive_action_policy"],
  "metadata": {
    "risk_score": 95
  }
}</pre>
                        </div>
                    </div>
                </div>

                <!-- Mock Trace Item 3: PAUSED Decision -->
                <div class="trace-item" data-decision-type="PAUSED">
                    <div class="trace-timestamp">2024-01-28 10:20:00</div>
                    <div class="trace-line"></div>
                    <div class="trace-content">
                        <div class="trace-event">
                            <span class="event-type-badge event-audit">SUPERVISOR AUDIT</span>
                            <span class="event-source">SUPERVISOR_PAUSED</span>
                        </div>
                        <div class="trace-decision">
                            <span class="decision-badge decision-paused">
                                <span class="material-icons md-18">pause_circle</span> PAUSED
                            </span>
                            <div class="decision-reason">Task paused: Awaiting human approval</div>
                        </div>
                        <div class="trace-rules">
                            <div class="rules-label">Rules Applied:</div>
                            <div class="rules-list">
                                <span class="rule-badge">human_approval_required</span>
                            </div>
                        </div>
                        <div class="trace-risk">
                            <span class="risk-label">Risk Score:</span>
                            <span class="risk-value risk-medium">65/100</span>
                        </div>
                        <div class="trace-json-toggle">
                            <button class="btn-link trace-toggle-json" onclick="toggleJson('json3')">Show JSON</button>
                        </div>
                        <div class="trace-json hidden" id="json3">
                            <pre>{
  "decision_type": "PAUSED",
  "rules_applied": ["human_approval_required"],
  "metadata": {
    "risk_score": 65,
    "reason": "Task paused: Awaiting human approval"
  }
}</pre>
                        </div>
                    </div>
                </div>

                <!-- Mock Trace Item 4: Task Event -->
                <div class="trace-item" data-decision-type="">
                    <div class="trace-timestamp">2024-01-28 10:15:00</div>
                    <div class="trace-line"></div>
                    <div class="trace-content">
                        <div class="trace-event">
                            <span class="event-type-badge event-task">TASK EVENT</span>
                            <span class="event-source">TASK_CREATED</span>
                        </div>
                        <div class="event-metadata">
                            <span class="metadata-label">Source:</span>
                            <span class="metadata-value">chat-handler</span>
                        </div>
                        <div class="trace-json-toggle">
                            <button class="btn-link trace-toggle-json" onclick="toggleJson('json4')">Show JSON</button>
                        </div>
                        <div class="trace-json hidden" id="json4">
                            <pre>{
  "event_type": "TASK_CREATED",
  "source": "chat-handler",
  "task_id": "task-123",
  "timestamp": "2024-01-28T10:15:00Z"
}</pre>
                        </div>
                    </div>
                </div>
            </div>

            <div class="trace-load-more">
                <button class="btn-secondary">Load More</button>
            </div>
        </div>
    </div>

    <script>
        function toggleJson(id) {
            const jsonContainer = document.getElementById(id);
            const btn = event.target;
            if (jsonContainer.classList.contains('hidden')) {
                jsonContainer.classList.remove('hidden');
                btn.textContent = 'Hide JSON';
            } else {
                jsonContainer.classList.add('hidden');
                btn.textContent = 'Show JSON';
            }
        }

        // Test filter functionality
        document.getElementById('trace-search').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const items = document.querySelectorAll('.trace-item');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        document.getElementById('trace-filter-type').addEventListener('change', function() {
            const filterType = this.value;
            const items = document.querySelectorAll('.trace-item');
            items.forEach(item => {
                const decisionType = item.getAttribute('data-decision-type');
                item.style.display = !filterType || decisionType === filterType ? '' : 'none';
            });
        });
    </script>
</body>
</html>
