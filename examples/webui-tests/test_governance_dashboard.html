<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Governance Dashboard Test</title>
    <link rel="stylesheet" href="agentos/webui/static/css/components.css">
    <link rel="stylesheet" href="agentos/webui/static/css/governance-dashboard.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #f8f9fa;
        }
        #test-container {
            width: 100%;
            height: 100vh;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="test-container"></div>

    <!-- Load components -->
    <script src="agentos/webui/static/js/components/RiskBadge.js"></script>
    <script src="agentos/webui/static/js/components/TrendSparkline.js"></script>
    <script src="agentos/webui/static/js/components/MetricCard.js"></script>
    <script src="agentos/webui/static/js/components/HealthIndicator.js"></script>
    <script src="agentos/webui/static/js/views/GovernanceDashboardView.js"></script>

    <script>
        // Mock fetch to return test data
        const originalFetch = window.fetch;
        window.fetch = async (url) => {
            if (url.includes('/api/governance/dashboard')) {
                // Return mock data
                return {
                    ok: true,
                    json: async () => ({
                        generated_at: new Date().toISOString(),
                        metrics: {
                            risk_level: 'HIGH',
                            open_findings: 23,
                            blocked_rate: 0.15,
                            guarded_percentage: 0.85
                        },
                        trends: {
                            findings: {
                                current: 23,
                                direction: 'up',
                                change: 0.15,
                                data_points: [18, 19, 20, 21, 22, 23, 25]
                            },
                            blocked_decisions: {
                                current: 15.2,
                                direction: 'down',
                                change: -0.05,
                                data_points: [18, 17, 16, 15.5, 15.2, 15, 15.2]
                            },
                            guardian_coverage: {
                                current: 85,
                                direction: 'up',
                                change: 0.1,
                                data_points: [75, 78, 80, 82, 83, 84, 85]
                            }
                        },
                        top_risks: [
                            {
                                severity: 'CRITICAL',
                                type: 'FORBIDDEN_OPERATION',
                                title: 'Attempted file deletion in protected directory',
                                first_seen: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                                affected_tasks: 3
                            },
                            {
                                severity: 'HIGH',
                                type: 'RESOURCE_VIOLATION',
                                title: 'Memory limit exceeded in multiple tasks',
                                first_seen: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(),
                                affected_tasks: 7
                            },
                            {
                                severity: 'MEDIUM',
                                type: 'POLICY_VIOLATION',
                                title: 'Unapproved external API access detected',
                                first_seen: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
                                affected_tasks: 2
                            }
                        ],
                        health: {
                            guardian_coverage: 0.85,
                            avg_decision_latency_ms: 125,
                            tasks_with_audits: 0.92,
                            active_guardians: 4,
                            last_scan: new Date(Date.now() - 30 * 60 * 1000).toISOString()
                        }
                    })
                };
            }
            return originalFetch(url);
        };

        // Initialize the dashboard
        const container = document.getElementById('test-container');
        const dashboard = new GovernanceDashboardView();
        dashboard.render(container);

        console.log('Dashboard test initialized');
    </script>
</body>
</html>
